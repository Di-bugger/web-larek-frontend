# Проектная работа "Веб-ларек"
Реализация интернет-магазина с товарами для веб-разработчиков — Web-ларёк.
В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

- Используемый стек: TypeScript, HTML, SCSS.
- Для сборки используется Webpack.

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура

В проекте применен принцип MVP (Model-View-Presenter), обеспечивающий четкое разделение ответственностей:

- Model: Отвечает за работу с данными: загрузку данных по API, их хранение и обработку данных, введенных пользователем.
- View: Отвечает за отображение интерфейса, взаимодействие с пользователем и уведомление Presenter’а о действиях пользователя.
- Presenter: Отвечает за связь модели данных и отображения.

## Базовый код

### 1. Класс ```EventEmitter<T> ```
Базовый класс, используется для создания слушателей события.
Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Класс имеет такие основные методы:

- ``` on ```,  ```off ```,  ```emit ```  — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы 
- ```onAll``` и  ```offAll```  — для подписки на все события и сброса всех
подписчиков.

### 2. Класс ```Api ```
Базовый класс, используется для работы с api.

Конструктор принимает базовый url ```baseUrl: string``` , на который необходимо сделать запрос, а так же если необходимо дополнительные опции ```options: RequestInit = {}```.

Класс имеет такие основные методы:
- ```get(uri: string)``` - для получения данных с сервера.
- ```handleResponse(response: Response): Promise<object>``` - обрабатывает ответ, полученный от сервера после выполнения HTTP-запроса.
- ```post(uri: string, data: object, method: ApiPostMethods = 'POST')``` - для отправки данных на сервер. Метод может принимать в качестве параметра необходимый HTTP метод
```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```

## Компоненты модели данных

### 1. Класс ```ModelApi ```
Класс осуществляет доступ к данным и их получение через api. Наследуется от класса Api.

Констурктор класса принимает url ```baseUrl: string```, ```cdn: string```, и необязателньый параметр option ```option?: RequestInit``` . 

У класса есть поля:
- ```items: IProductItem[]``` - поле хранит массив из обьектов - товаров.
- ```cdn: string;``` - cdn для картинки товара.

Класс имеет такие основные методы:
- ```getProductList(): Promise<IProductItem[]>``` - возвращает промис - массив обьектов(продуктов).
- ```postOrder(order: IOrderItems): Promise<IOrderDone>>``` - делает запрос "post" c передаваемыми данными заказа, возвращает промис - обьект с данными заказа.


### 2. Класс ```ModelBasket ```
Класс осуществляте доступ к данным корзины и способы взаимодействия с ней - удаление и добавление товара.

Конструктор не приниает никаких парметров. Происходит иницилиация ```items``` - пустым массивом.

У класса есть поля:
- ```items: IProductItem[] = []``` - поле хранящее массив обьектов - товаров, помещенных в корзину.

Класс имеет такие основные методы:
- ```addItem(item: IProductItem): void``` - добавляет товар, переданный в качестве параметра, в корзину.
- ```removeItem(item: IProductItem): void``` - удаляет товар, переданный в качестве параметра, удаляет товар по из значению id из карточки товара.
- ```getCountItems(): number``` - получает количество товаров в корзине.
- ```getTotalPrice(): number;``` - возвращает полную стоимость товаров в корзине.
- ```clearBasket(): void``` - очищает корзину.

У класса имеются get и set:
- ```get items``` - для получения корзины с товарами.
- ```set items(data: IProductItem[]) ``` - для  установки товаров в корзине - items (защищенное свойство)

### 3. Класс ```ModelCatalog ```
Класс осуществляет доступ к данным каталога товаров.

Констурктор принимает Events - благодаря которому можно навесить слушатель события на изменение данных.
Происходит иницилиация ```productList``` - пустым массивом.

У класса есть поля:
- ```productList: IProductItem[]``` - поле содержит все товары в каталоге. Имеется доступ для получения каталога и установки каталога.
- ```selectedItems: IProductItem``` - поле содержащее выбранный товар.

Класс имеет такие основные методы:
- ```setOpenCard(item: IProductItem)``` - устанавливает открытую карточку и генерируется событие ```modalCard:open```.

У класса имеются get и set:
- ```get productList``` - для получения списка всех товаров.
- ```set productList(data: IProductItem[])``` - для установки списка товаров, переданых в качестве параметра. А так же навешивание слушателя события ```'productList:changed'```

### 4. Класс ```UserDataModel ```
Класс осуществляет доступ к веденным данным пользователя для заказа.

Констурктор принимает Events - благодаря которому можно навесить слушатель события на изменение данных.
А так же происходит инициализация полей пустыми значениями (для totalCost нулевым значением, для orderItems - пустым массивом )

У класса есть поля:
- ```email```,```phone```, ```address```, ```typeCost```, ```totalCost``` - данные о Email, телефон, адресс доставки, тип оплаты, полная стоимость заказа.
- ```formErrors``` - хранит сообщения об ошибке.

Класс имеет такие основные методы:
- ```addAddress(field: string, value: string): void``` - устанавливает определенный адресс доставки.
- ```addInfoUser(data: string, value: string): void``` - проверяет передаваемый параметр и  устанавливает либо номер телефона, либо email.
- ```getOrder(): object``` - формирует окончательный обьект заказа.
- ```validateOrder(): boolean``` - валидирует введеный адресс, используется в методе addAddress.
- ```validateContacts(): boolean``` - валидирует введеный email и телефон, используется в методе addInfoUser.

## Компоненты модели представления

### 1. Класс ```Card ```
Класс для отображения представления одной карточки.

Конструктор принимает template, в который и будет подставлены данные карточки.
Так же конструктор принимает вторым параметром - объект с методом, который навешивается по клику на карточку товара.
А так же происходит инициализация всех необходимых состоявляющих карточки.

У класса есть поля:
- ```protected _cardElement: HTMLElement``` - сам элемент картчоки.
- ```protected _cardTitle: HTMLElement``` -  заголовок карточки товара.
- ```protected _cardImage: HTMLImageElement``` -  картинка карточки товара.
- ```protected _cardPrice: HTMLElement``` -  цена карточки товара.
- ```protected _cardCategory: HTMLElement;``` -  категория карточки товара.
- возможные категории карточки товаров
```
  protected _colors = <Record<string, string>> {
		"дополнительное": "additional",
		"софт-скил": "soft",
		"кнопка": "button",
		"хард-скил": "hard",
		"другое": "other",
 ``` 

Класс имеет такие основные методы:
- ```setText(element: HTMLElement, value: unknown)``` - для установки, переданного как параметр текста в необходимый, переданный HTML-элемент.
- ```setPrice(value: number | null)``` - для установки, переданного как параметр значения стоимости продукта. В случае отсутствия цены - товар бесценный.
- ```render(data: IProductItem)``` - возвращает HTML-элемент - карточку товара.

У класса имеются set:
- ```cardCategory(value: string)``` - для установки категории товара.

### 2. Класс ```CardDetailed ```
Класс для отображения представления одной карточки, при открытии модального окна. Наследуется от ```Card```.

Конструктор принимает template, в который и будет подставлены данные карточки, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих карточки.
Для кнопки карточки товара происходит навешивание слушателя  ```card:addToBasket```.

У класса есть поля:
- ```description: HTMLElement``` - подробное описание карточки.
- ```button: HTMLElement``` -  кнопка добавления товара в корзину.

Класс имеет такие основные методы:
- ```notForSale(data:IProductItem)``` - для проверки наличия цены товара, и если товар бесценый - дезактивирование кнопки.
- ```render(data: IProductItem)``` - возвращает HTML-элемент - карточку товара 

### 3. Класс ```BasketItem ```
Класс для отображения представления одного продукта в корзине.

Конструктор принимает template, в который и будет подставлены данные одного продукта, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих карточки.
Так же конструктор принимает вторым параметром - объект с методом, который навешивается по клику на кнопку удаления карточки товара.

У класса есть поля:
- ```basketItem : HTMLElement``` -  этот пункт списка представляет собой элемент корзины - карточку товара.
- ```title : HTMLElement``` -  заголовок карточки товара в корзине.
- ```index : HTMLElement``` -  номер карточки товара в корзине.
- ```price: HTMLElement``` -  цена карточки товара в корзине.
- ```buttonDelete: HTMLButtonElement``` -  кнопка удаления карточки товара в корзине.

Класс имеет такие основные методы:
- ```setPrice``` - для установки, переданного как параметр значения стоимости продукта.
- ```render(data: IProductItem, item: number)``` - возвращает HTML-элемент - карточку товара для корзины. В качестве параметра принимает данные о карточке товара и номер товара в корзине.

### 4. Класс ```Basket ```
Класс для отображения представления всей корзины товаров.

Конструктор принимает template, в который и будет подставлены данные товаров в корзине, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих карточки.
Для кнопки оформления заказа происходит навешивание слушателя  ```'order:open'```.
А для кнопки коризны в шапке сайта  ```'basket:open'``` .

У класса есть поля:
- ```basket: HTMLElement``` -   контейнер корзины.
- ``` title: HTMLElement ``` -  используется для заголовка внутри модального окна.
- ``` basketList: HTMLElement ``` -  представляет собой неупорядоченный список, в котором будут отображаться элементы корзины (товары, добавленные пользователем).
- ``` orderButton: HTMLButtonElement ``` -  кнопка оформления заказа.
- ``` basketPrice: HTMLElement ``` -  поле общей стоимости всех товаров в корзине.
- ``` iconBasketButton: HTMLButtonElement ``` -  кнопка отображения корзины в шапке сайта.
- ``` iconCounterBasket: HTMLElement ``` -  количество товаров в корзине в шапке сайта.

Класс имеет такие основные методы:
- ```renderCounterBasket(value: number)``` - для установки, переданного как параметр значения количества товаров.
- ```renderSumAllProducts(sumAll: number)``` - для установки, переданного как параметр значения стомости всех товаров.
- ```render``` - возвращает HTML-элемент - разметку корзины.

У класса имеются set:
- ```items(items: HTMLElement[])``` - для установки элементов, переданных в качестве параметра, в корзине.

### 5. Класс ```Modal ```
Класс для отображения модальных окон.

Конструктор принимает template, в который и будет подставляться разметка модального окна, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих карточки.

У класса есть поля:
- ```protected modal: HTMLElement``` -  само модальное окно.
- ```protected closeButton: HTMLButtonElement``` - кнопка закрытия модального окна.
- ```protected _modalContent: HTMLElement``` - контейнер, содержащий контент модального окна.

Класс имеет такие основные методы:
- ```open``` - открывает модальное окно. Происходит навешивание слушателя  ```'modal:open'```.
- ```close``` - открывает модальное окно. Происходит навешивание слушателя  ```'modal:close'```.
- ```render``` - возвращает разметку модального окна.

У класса имеются set: 
- ```content(element: HTMLElement)``` - для установки содержимого в поле _modalContent. Принимает HTML-элемент, который необходимо вставить.

### 6. Класс ```Order ```
Класс для отображения окна заказа,где происходит ввод адресса, выбор оплаты.

Конструктор принимает template, в который и будет подставляться разметка заказа, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих данного окна.
При отправке формы заказа происходит навешивание слушателя  ```'userinfo:open'```.
Так же  происходит навешивание слушателя при изменение данных в поле адресса ```order:changeAddress,{ field, value }```.
Так же  происходит навешивание слушателя выборе способа оплаты ```'order:paymentSelection', item```.

У класса есть поля:
- ```formOrder: HTMLFormElement``` -  сам элемент формы.
- ```formErrors: HTMLElement``` -  для отображения ошибки при вводе данных.
- ```paySelect: string;``` -  для хранения активной кнопки способа оплаты.
- ```buttonAll: HTMLButtonElement[]``` -  список всех кнопок. Используется для того, чтобы при выборе определного типа оплаты подсвечивать кнопку.

Класс имеет такие основные методы:
- ```render``` -  возвращает разметку формы.

У класса имеются set: 
- ```activeButton(value: boolean)``` -  делает кнопку продолжения оформления заказа активной/неактивной. Будет использоваться при проверки валидности данных.
- ```paySelect(payMethod: string)``` -  делает кнопку способа оплаты активной/неактивной.

### 7. Класс ```OrderContacts ```
Класс для отображения окна заказа,где происходит ввод данных пользователя - email, phone.

Конструктор принимает template, в который и будет подставляться разметка заказа, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих данного окна.
Так же  происходит навешивание слушателя при изменение данных в полях email и phone ```userinfo:changeContacts, { field, value }```
При отправке формы заказа происходит навешивание слушателя  ```'success:open'```.

У класса есть поля:
- ```formContacts: HTMLFormElement``` -  сам элемент формы.
- ```buttonSubmit: HTMLButtonElement``` -  кнопка подтверждения введеных данных и перехода к оплате.
- ```inputAll: HTMLInputElement[]``` -  список всех input. Используется для того, чтобы навесить на все поля ввода событие.
- ```formErrors: HTMLElement``` - для отображения ошибки при вводе данных.

Класс имеет такие основные методы:
- ```render``` -  возвраащает разметку формы

У класса имеются set:
- ```activeButton(value: boolean)``` -  делает кнопку активной/неактивной. Будет использоваться при проверки валидности данных.

### 8. Класс ```Success ```
Класс для отображения финального успешного окна заказа.

Конструктор принимает template, в который и будет подставляться разметка окна об успехе заказа, и events для навешивания слушателей событий.
А так же происходит инициализация всех необходимых состоявляющих данного окна.
При клике по кнопке окна  происходит навешивание слушателя  ```'success:close'```.

У класса есть поля:
- ```successContent: HTMLElement``` -  сам контейнер для контента окна заказа.
- ```description: HTMLElement``` -  текст для информарования о количестве списанных синапсов.
- ```button: HTMLButtonElement``` -  кнопка для продолжения просмотра товаров.

Класс имеет такие основные методы:
- ```render(total: number)``` -  возвращает разметку окна успешного заказа. В качестве параметра принимается полная стоимость заказа.

### 9. Класс ```Page ```
Класс отвечающий за представление страницы.

Конструктор не принимает параметров, происходит инициализация всех необходимых состоявляющих.

У класса есть поля:
- ```protected _pageWrapper: HTMLElement``` - контейнер для контента всей станицы. В дальнейшем будет использоваться для запрета прокрутки страницы, во время открытия модалки.

У класса имеются set:
- ```scrollLock(locked: boolean)``` - для установки запрета прокрутки страницы. Будет принимать true - запрещено, false -  разрешено.

## Presenter
Вся функциональность presenter будет располагаться в главном файле - index.ts

### События

- ```productList:changed``` - для отображения карточек товара на странице.

- ```card:select``` - для определения карточки по которйо произошел клик.
- ```card:addToBasket``` - для реагирования на клик по кнопке добавления товара в корзину.
- ```card:deleteFromBasket``` - для реагирования на клик по кнопке удаления товара из корзины.
- ```modalCard:open``` - для реагирования на клик по карточке и открытие конкретной карточки.

- ```modal:open``` - для реагирования на открытие модального окна. Используется для блокирования прокрутки страницы.
- ```modal:close``` - для реагирования на закрытие модального окна. Используется для возобновления возмонжности прокрутки страницы.

- ```basket:open``` - для реагирования на клик по корзине в шапке сайте и открытие корзины.

- ```order:open``` - для реагирования на клик кнопке переводящей к способу оплаты и указания адресса.Открывает модальное окно.
- ```order:paymentSelection``` - для реагирования на клик по кнопке способа оплаты и установка определенного способа оплаты.
- ```order:changeAddress``` - для отслеживания изменений в поле ввода "адресс доставки" .

- ```userinfo:open``` - для открытия модального окна с "email" и "phone" .
- ```userinfo:changeContacts``` - для отслеживания изменений в поле ввода "email" и "phone" .

- ```success:open``` - для открытия модального окна об успешном заказе и отправка запроса post с передаваемыми данными заказа.
- ```success:close``` - для закрытия модального окна об успешном заказе .

- ```formErrors:address``` - для отслеживания некоорректного введеного адресса и установки кнопки для продолжения оформления заказа .
- ```formErrors:change``` - для отслеживания некоорректного введеного email и phone и установки кнопки для завершения оформления заказа .
- ```userinfo:changeContacts``` - для отслеживания изменения в полях введения email и phone .
